{% load static %}
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ - Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø´Ø§Ù¾</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    
    <style>
        @font-face {
            font-family: 'IranSans';
            src: url('{% static "fonts/IranianSans.ttf" %}');
        }
        
        body { 
            font-family: 'IranSans', sans-serif; 
            background-color: #fafafa;
        }
        
        .form-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }
        
        .fade-in-visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .input-error {
            border-color: #dc2626 !important;
            background-color: #fef2f2;
        }
        
        .shipping-option {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }
        
        .shipping-option:hover {
            border-color: #fb923c;
            background-color: #fff7ed;
        }
        
        .shipping-option.selected {
            border-color: #fb923c;
            background-color: #fff7ed;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">

    <!-- Ù‡Ø¯Ø± -->
    <nav class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-30 backdrop-blur-sm bg-white/95">
        <div class="max-w-screen-xl flex items-center justify-between mx-auto p-4">
            <div class="flex items-center gap-3">
                <a href="{% url 'store:home' %}" class="flex items-center gap-2">
                    <img src="{% static 'images/logo.png' %}" class="h-8" alt="Narenji Logo" />
                    <span class="hidden sm:block text-xl font-bold text-orange-600">Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø´Ø§Ù¾</span>
                </a>
            </div>
            
            <div class="flex items-center gap-4">
                <a href="{% url 'store:home' %}" class="text-orange-500 hover:text-orange-600 flex items-center gap-2 font-medium transition-colors">
                    <i class='bx bx-home-alt'></i>
                    <span class="hidden sm:inline">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø®Ø§Ù†Ù‡</span>
                </a>
            </div>
        </div>
    </nav>

    <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ -->
    <div class="max-w-2xl mx-auto px-4 py-8 fade-in">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-4">ğŸ“ ØªÚ©Ù…ÛŒÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÙØ§Ø±Ø´</h1>
            <p class="text-gray-600">Ù„Ø·ÙØ§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø³ÙØ§Ø±Ø´ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>
        </div>

        <!-- Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù‡Ø§ÛŒ Ø®Ø·Ø§ -->
        {% if messages %}
        <div class="mb-6">
            {% for message in messages %}
            <div class="p-4 mb-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3">
                <i class='bx bx-error text-red-500 text-xl'></i>
                <div>
                    <p class="text-red-800 font-medium">{{ message }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="form-card p-6 md:p-8">
            <form method="POST" class="space-y-6" action="{% url 'orders:order_confirm_view' %}">
                {% csrf_token %}

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="name" class="block mb-2 text-sm font-medium text-gray-700">
                            <i class='bx bx-user text-orange-500'></i>
                            Ù†Ø§Ù… Ú©Ø§Ù…Ù„
                        </label>
                        <input type="text" name="name" id="name"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-500 text-sm transition {% if form.name.errors %}input-error{% endif %}"
                               placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ"
                               value="{{ form.name.value|default:'' }}"
                               required>
                        {% if form.name.errors %}
                        <div class="error-message">
                            <i class='bx bx-error-circle'></i>
                            {{ form.name.errors.0 }}
                        </div>
                        {% endif %}
                    </div>

                    <div>
                        <label for="phone" class="block mb-2 text-sm font-medium text-gray-700">
                            <i class='bx bx-phone text-orange-500'></i>
                            Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³
                        </label>
                        <input type="text" name="phone" id="phone"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-500 text-sm transition {% if form.phone.errors %}input-error{% endif %}"
                               placeholder="09xxxxxxxxx"
                               value="{{ form.phone.value|default:'' }}"
                               required>
                        {% if form.phone.errors %}
                        <div class="error-message">
                            <i class='bx bx-error-circle'></i>
                            {{ form.phone.errors.0 }}
                        </div>
                        {% endif %}
                    </div>
                </div>

                <div>
                    <label for="email" class="block mb-2 text-sm font-medium text-gray-700">
                        <i class='bx bx-envelope text-orange-500'></i>
                        Ø§ÛŒÙ…ÛŒÙ„
                    </label>
                    <input type="email" name="email" id="email"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-500 text-sm transition {% if form.email.errors %}input-error{% endif %}"
                           placeholder="example@email.com"
                           value="{{ form.email.value|default:'' }}"
                           required>
                    {% if form.email.errors %}
                    <div class="error-message">
                        <i class='bx bx-error-circle'></i>
                        {{ form.email.errors.0 }}
                    </div>
                    {% endif %}
                </div>

                <div>
                    <label for="postal_code" class="block mb-2 text-sm font-medium text-gray-700">
                        <i class='bx bx-map text-orange-500'></i>
                        Ú©Ø¯ Ù¾Ø³ØªÛŒ
                    </label>
                    <input type="text" name="postal_code" id="postal_code"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-500 text-sm transition {% if form.postal_code.errors %}input-error{% endif %}"
                           placeholder="xxxxxxxxxx"
                           value="{{ form.postal_code.value|default:'' }}"
                           required>
                    {% if form.postal_code.errors %}
                    <div class="error-message">
                        <i class='bx bx-error-circle'></i>
                        {{ form.postal_code.errors.0 }}
                    </div>
                    {% endif %}
                </div>

                <div>
                    <label for="address" class="block mb-2 text-sm font-medium text-gray-700">
                        <i class='bx bx-home text-orange-500'></i>
                        Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„
                    </label>
                    <textarea name="address" id="address" rows="4"
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400 focus:border-orange-500 text-sm transition resize-none {% if form.address.errors %}input-error{% endif %}"
                              placeholder="Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„ Ù¾Ø³ØªÛŒ Ø´Ø§Ù…Ù„ Ø´Ù‡Ø±ØŒ Ø®ÛŒØ§Ø¨Ø§Ù†ØŒ Ú©ÙˆÚ†Ù‡ØŒ Ù¾Ù„Ø§Ú© Ùˆ ..."
                              required>{{ form.address.value|default:'' }}</textarea>
                    {% if form.address.errors %}
                    <div class="error-message">
                        <i class='bx bx-error-circle'></i>
                        {{ form.address.errors.0 }}
                    </div>
                    {% endif %}
                </div>
                
                <!-- Ø¨Ø®Ø´ Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ´ Ø§Ø±Ø³Ø§Ù„ -->
                <div class="border border-gray-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2">
                        <i class='bx bx-package text-orange-500'></i>
                        Ø±ÙˆØ´ Ø§Ø±Ø³Ø§Ù„
                    </h3>
                    
                    <div class="space-y-4" id="shipping-options">
                        <!-- ØªÛŒÙ¾Ø§Ú©Ø³ - Ù¾ÙØ³â€ŒÚ©Ø±Ø§ÛŒÙ‡ -->
                        <label class="shipping-option flex items-start gap-3 p-4 border-2 border-gray-300 rounded-lg cursor-pointer transition-all">
                            <input type="radio" name="shipping_method" value="tipax" class="mt-1 text-orange-500 focus:ring-orange-400">
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-800">ØªÛŒÙ¾Ø§Ú©Ø³</span>
                                    <span class="text-green-600 font-semibold">Ù¾ÙØ³â€ŒÚ©Ø±Ø§ÛŒÙ‡</span>
                                </div>
                                <p class="text-sm text-gray-600 mt-1">Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„ ØªÙˆØ³Ø· Ú¯ÛŒØ±Ù†Ø¯Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
                                <p class="text-xs text-blue-600 mt-1">ØªØ­ÙˆÛŒÙ„: Û² ØªØ§ Û´ Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ</p>
                            </div>
                        </label>
                        
                        <!-- Ù¾Ø³Øª Ù¾ÛŒØ´ØªØ§Ø² -->
                        <label class="shipping-option flex items-start gap-3 p-4 border-2 border-gray-300 rounded-lg cursor-pointer transition-all selected">
                            <input type="radio" name="shipping_method" value="post" class="mt-1 text-orange-500 focus:ring-orange-400" checked>
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-800">Ù¾Ø³Øª Ù¾ÛŒØ´ØªØ§Ø²</span>
                                    <span class="text-orange-600 font-semibold">Û¸Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</span>
                                </div>
                                <p class="text-sm text-gray-600 mt-1">ØªØ­ÙˆÛŒÙ„: Û´ ØªØ§ Û· Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ</p>
                            </div>
                        </label>
                        
                        <!-- Ù¾Ø³Øª ÙˆÛŒÚ˜Ù‡ -->
                        <label class="shipping-option flex items-start gap-3 p-4 border-2 border-gray-300 rounded-lg cursor-pointer transition-all">
                            <input type="radio" name="shipping_method" value="special_post" class="mt-1 text-orange-500 focus:ring-orange-400">
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <span class="font-medium text-gray-800">Ù¾Ø³Øª ÙˆÛŒÚ˜Ù‡</span>
                                    <span class="text-orange-600 font-semibold">Û±Û´Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</span>
                                </div>
                                <p class="text-sm text-gray-600 mt-1">ØªØ­ÙˆÛŒÙ„: Û² ØªØ§ Û³ Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ</p>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª -->
                <div class="p-4 bg-orange-50 rounded-lg text-center border border-orange-200">
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm text-gray-700">
                            <span>Ù…Ø¨Ù„Øº Ú©Ø§Ù„Ø§Ù‡Ø§:</span>
                            <span>{{ cart.get_total_price|floatformat:0 }} ØªÙˆÙ…Ø§Ù†</span>
                        </div>
                        <div class="flex justify-between text-sm text-gray-700">
                            <span>Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„:</span>
                            <span id="shipping-cost">Û¸Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</span>
                        </div>
                        <div class="border-t border-orange-200 pt-2">
                            <p class="text-gray-700 text-sm">Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª</p>
                            <p class="text-2xl font-bold text-orange-600 mt-1" id="total-price">
                                {{ cart.get_total_price|add:80000|floatformat:0 }} ØªÙˆÙ…Ø§Ù†
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Ø¯Ú©Ù…Ù‡ Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù… -->
                <div class="text-center pt-6">
                    <button type="submit" 
                            class="bg-orange-500 hover:bg-orange-600 text-white px-8 py-4 rounded-lg font-semibold text-lg shadow-lg shadow-orange-200 transition duration-200 w-full md:w-auto transform hover:scale-105">
                        <i class='bx bx-credit-card'></i>
                        Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ ØªÚ©Ù…ÛŒÙ„ Ø³ÙØ§Ø±Ø´
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÙÙˆØªØ± -->
    <footer class="bg-white py-8 md:py-12 border-t border-gray-200 mt-12">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-6">Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø´Ø§Ù¾</h2>
            
            <div class="flex justify-center gap-4 md:gap-6 mb-6">
                <a href="https://www.instagram.com/narenji.shopping" target="_blank" 
                   class="w-10 h-10 md:w-12 md:h-12 bg-gray-100 text-orange-500 rounded-full flex items-center justify-center hover:bg-orange-500 hover:text-white transition duration-300">
                    <i class='bx bxl-instagram text-xl md:text-2xl'></i>
                </a>
                <a href="https://t.me/narenjishopping" target="_blank" 
                   class="w-10 h-10 md:w-12 md:h-12 bg-gray-100 text-orange-500 rounded-full flex items-center justify-center hover:bg-orange-500 hover:text-white transition duration-300">
                    <i class='bx bxl-telegram text-xl md:text-2xl'></i>
                </a>
            </div>
            
            <p class="text-xs md:text-sm text-gray-600">Â© 2025 Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø´Ø§Ù¾ - ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† fade-in
            document.querySelector('.fade-in').classList.add('fade-in-visible');
            
            const shippingRadios = document.querySelectorAll('input[name="shipping_method"]');
            const shippingCostElement = document.getElementById('shipping-cost');
            const totalPriceElement = document.getElementById('total-price');
            const shippingOptions = document.querySelectorAll('.shipping-option');
            
            // Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„
            const shippingCosts = {
                'tipax': 0,
                'post': 80000,
                'special_post': 140000
            };
            
            // Ù…ØªÙ†ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÙØ³â€ŒÚ©Ø±Ø§ÛŒÙ‡
            const shippingTexts = {
                'tipax': 'Ù¾ÙØ³â€ŒÚ©Ø±Ø§ÛŒÙ‡',
                'post': 'Û¸Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†',
                'special_post': 'Û±Û´Û°,Û°Û°Û° ØªÙˆÙ…Ø§Ù†'
            };
            
            // Ù…Ø¨Ù„Øº Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø§Ø² Django
            const subtotal = parseFloat("{{ cart.get_total_price }}");
            
            // ÙØ±Ù…Øª Ú©Ø±Ø¯Ù† Ø¹Ø¯Ø¯ Ø¨Ù‡ ØµÙˆØ±Øª ÙØ§Ø±Ø³ÛŒ Ø¨Ø§ Ø¬Ø¯Ø§Ú©Ù†Ù†Ø¯Ù‡
            function formatPrice(price) {
                if (price === 0) return 'Ù¾ÙØ³â€ŒÚ©Ø±Ø§ÛŒÙ‡';
                return new Intl.NumberFormat('fa-IR').format(price) + ' ØªÙˆÙ…Ø§Ù†';
            }
            
            // Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ´ Ø§Ø±Ø³Ø§Ù„
            shippingRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const selectedMethod = this.value;
                    const shippingCost = shippingCosts[selectedMethod];
                    const totalPrice = subtotal + shippingCost;
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ø³ØªØ§ÛŒÙ„ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
                    shippingOptions.forEach(option => {
                        option.classList.remove('selected');
                    });
                    this.closest('.shipping-option').classList.add('selected');
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„
                    shippingCostElement.textContent = shippingTexts[selectedMethod];
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù…Ø¨Ù„Øº Ú©Ù„
                    totalPriceElement.textContent = formatPrice(totalPrice);
                });
            });
        });
    </script>
</body>
</html>